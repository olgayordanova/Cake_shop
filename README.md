# Онлайн сладкарница

Този проект е представя опит да бъде реализирана част от функционалността на една онлайн сладкарница.

## Описание

В приложението могат да се регистрират клиенти, които да разглеждат продуктите, които сладкарницата предлага, а също и да пускат поръчки за покупка на такива. Приложението се контролира от потребители с по-разширени права (на служители), както и от администратор с пълен достъп до цялата функционалност на сайта. 

## Техническо изпълнение
Проекта е изпълнен с Django 3.2.5
В проекта е използвана  PostgreSQL ORDBMS
Кода на проекта може да бъде разгледан в Github, следвайки следният линк: https://github.com/olgayordanova/cake_shop

Проекта е логически разделен в няколко модула.

## Модул "Регистрация на потребители и клиенти"

Изпълнена е login/register функционалност с използване на Extended Django user. 
Кода на посочения модул е организиран в папки cake_shop_auth и profiles. След като се осъществи първоначалната регистрация на потребителя има възможност да до-попълни своя профил, за което приложението го подсеща. Последващата аутентикация се осъществява посредством e-mail и парола. 

Models:  CakeShopUser наследява AbstractBaseUser и PermissionsMixin и използва CakeShopUserManager, който дефинира начините на регистрация на is_staff, is_superuser, както и валидира минимално изискваните данни за регистрация. 

CakeShopUserManager е дефиниран в settings.py като AUTH_USER_MODEL (основен UserModel).

Към модула за регистрация  е добавен и модела Profile (models.Model) с връзка OneToOne към UserModel, който потребителя може да попълва допълнително. 
Добавена е функционалност за сигнализиране при регистрация на потребител (user_created) и за попълване на профил (check_is_complete) в signals.py. Добавен е и templatetags profile_complete_notification, който служи за маркер, когато профила на клиента е изпълнен.

Forms: Формата за регистрация SignUpForm е стандартна UserCreationForm. Формата за аутентикация SignInForm е наследник на AuthenticationForm, като  метода clean_password е с пренаписана функционалност, за да може потребителя да се аутентикира с e-mail и парола. ProfileForm е стандартен наследник на forms.ModelForm.

Views:  SignUpView и SignInView са изпълнени като Class Base View’s, а sign_out е стандартен logout. profile_details е декориран с @login_required и контролира функционалността при допопълване на потребителският профил.

URL’s:  Данните се визуализират посредством съответните пътища: регистрация: sign-up/, аутентикация: sign-in/ и отписване: sign-out/. 


Templates: Организирани са няколко темплейта, които позволяват на потребителите да комуникират интерактивно когато се регистрират, аутентикират и допълват данни в профила си. Разположени са в cake_shop\templates\auth  и cake_shop\templates\profile.

## Модул "Администрация"
В проекта е разработен модул за администрация, в който са достъпни данните за всички потребители. Дадена е възможност за дефиниране на права и групи с права. Отделно, потребителите, които имат права за достъп като служители до админ-панела могат да управляват всички продукти, както имат достъп до поръчките на клиентите. Администратора има пълен достъп на всички нива. 

Админ модела за потребителите е изпълнен чрез наследяване на UserAdmin и декориран с @admin.register, което дава възможност за имплементиране на по-практичен  и удобен дизайн на панела. Останала функционалност е застъпена в три класа, добавящи моделите от основната бизнес логика към админ панела – ProductAdmin, OrderAdmin, OrderItemAdmin. Изпълнени са чрез наследяване на admin.ModelAdmin.

## Модул "Търговия"
Бизнес-логиката на приложението е изпълнена основно в cake_shop_app. Когато определен клиент избере продукт, той може да го добави в количката си и да продължи с пазаруването. 

В лентата на навигацията се появява икона на количка, което показва, че клиента има активна поръчка. Клиента има достъп до продуктите в количката, както и до информация за цените, отстъпките и общата сума на поръчката. След като нареди поръчката, тя става със статус complete.

### Models: 
Дефинирани са три модела.

### Product(models.Model):
В този модел се дефинират основните характеристики на продуктите – като име, тип, описание, цена, отстъпка и снимка на продукта. Типа на продукта е подготвен да бъде избираем между два основни типа, но може да бъде лесно разширен, ако се наложи. В полетата за цена и отстъпка са ползвани build-in валидатори MinValueValidator и  MaxValueValidator. Всички CRUD операции по отношение на този модел са достъпни само за потребителите, които имат права на служители, както и до администратора. Клиентите могат само да разглеждат и да поръчват продукта. 

### OrderItem(models.Model): 
Съхранява данни за продукта и количеството от него, в определена поръчка. Свързан е с Product и UserModel посредством ForeignKey и връзка OneToMany към съответните id на посочените модели. По този начин се дава възможност за по-нататъшна филтрация, когато е необходимо да се изпълни условието, всеки клиент да има достъп само до своите поръчки. Към модела има разписани няколко метода, които изграждат удобна функционалност към някой производни параметри на модела – обща сума, крайна сума и т.н.

### Order(models.Model):
Съхранява данни за продуктите поръчани от даден клиент. Свързан е с UserModel посредством ForeignKey към съответното id посочения модел. Връзката към OrderItem е от типа ManyToMany и се имплементира в базата данни с междинната мапинг таблица cake_shop_app_order_items.  Към модела е закачен метод get_total_price, който изчислява общата стойност на конкретна поръчка.

### Forms: 
Дефинирана е една форма ProductCreateForm, през която се създава нов продукт. Формата наследява класа Meta на основния родител forms.ModelForm. Надгражда базовата функционалност на родителя с няколко widgets. За останалите модели не са дефинирани форми, тъй като те идват build in с ползването на Class Base Views. 

### Views: 
Използвани са основно Class Base View’s, даващи различна функционалност на приложението. В част от тях са пренаписани някой от стандартните методи на класа родител, съобразно спецификите на приложението:
IndexView ( ListView )
ProductView ( DetailView )
ProductCreateView ( AnyGroupRequiredMixin, CreateView )
ProductUpdateView ( AnyGroupRequiredMixin, UpdateView )
ProductDeleteView ( AnyGroupRequiredMixin, DeleteView )
OrderSummaryView(LoginRequiredMixin, View):
OrderItemListView(ListView)
OrderItemDetailView(SingleObjectMixin,ListView )

Класът AnyGroupRequiredMixin дава възможност да се дефинират правата на отделните потребители и групи, които работят със съответният клас наследник. ProductCreateView, ProductUpdateView и ProductDeleteView се достъпват само от потребители с права на служител и съответно от администратора. В ProductDeleteView са разписани допълнителни рестрикции, касаещи всички – продукта не може да бъде изтриван, ако има активна поръчка в която той присъства. 

Основната логика, която имплементира възможността да се работи с „количка“ е разписана във функции:
add_to_cart – Добавя продукти към количката. Ако продукта е в количката, добавя само количество към него.
complete_order – Променя статуса на поръчката в complete = True.

Добавен е templatetags - cart_item_count, който подава на съответният шаблон информация на за броя на продуктите в активната количка.

Приложението има внедрена система за Error Handling, където е необходимо. Чрез django.contrib messages приложението информира потребителя по отношение на действията, които е извършил. 

Функцията about_us насочва потребителя към страница с информация за производителя.

### URL’s: 
В URL’s са описани пътищата към всички описани по-горе View’s. 
Templates: Всички шаблони свързани с cake_shop_app са разположени в cake_shop\templates, както и в поддиректории cake_shop, cart, common и tags. Ползване механизма за множествено наследяване на шаблони.

## Тестове
С демонстрационна цел са изготвени тестовете на модела Product.
Изготвен  е и един integration test IndexTests(TestCase)

## Заключение
Този проект е изготвен с учебна цел и не предоставя пълната функционалност на един интернет магазин. Няма изградена система за плащания и проследяване на поръчките.
